---
layout: blogpost
title: The Future of Construct
tags: [construct]
description: Discussing future plans for Construct
---

<img src="http://tomerfiliba.com/static/res/2012-05-16-construct-logo-small.png" title="Construct" style="float:right" width="250px" />

It's been a long while since I've done any work on [Construct](http://construct.wikispaces.com)
... Construct 2.0 was released in 2007, and it's pretty much stayed the same. Luckily for all of
us, [Corbin Simpson](https://github.com/MostAwesomeDude/) took up the project in 2011 and has
been maintaining it since then. He brought it to github, changed the project to use a proper 
directory structure, solved many issues with the library itself, and wrote 
[extensive documentation](http://construct.readthedocs.org/en/latest/). Since then, Construct has been 
building a solid community and has reached quite a remarkable number of downloads on PyPI. 

All this time, I've been working (err, pondering) on *Construct 3*... it's been dragging on and off
for three or four years now. I got some sketches, toyed with some ideas, cleaned up the 
implementation of Construct's core... but it's remained in dream-land. A couple of months ago I 
decided I'd back-port a nice feature of Construct 3: [this expressions](https://github.com/construct/construct/commit/969e5685ce7251af49c9e267a732b63bcea4e278),
and it has rekindled my interest in Construct. 

`This` Expressions
------------------

One of the goals of Construct 3 was to be able to generate efficient (C/Python) code from 
constructs. It even worked, to some extent: for instance, [this snippet] 
(http://sebulbasvn.googlecode.com/svn/trunk/ccon/test.py) automatically generates 
[this C-code](http://sebulbasvn.googlecode.com/svn/trunk/ccon/moshe.c)... I didn't even remember
I'd done it [until today](https://github.com/MostAwesomeDude/construct/pull/20#issuecomment-5727638).
Funny.

Anyway, Construct 2 uses ``lambda`` functions to represent dependencies between constructs, e.g.

{% highlight python %}
s = Struct("LV",
    UBInt8("length"),
    Bytes("value", lambda ctx: ctx["length"]),
)
{% endhighlight %}

and if this is the case, it would be impossible to translate dependencies to C. So I've created
the ``this`` object, which essentially **builds** an expression tree from Python expressions,
and you can evaluate it by invoking it:

{% highlight pycon %}
>>> from construct import this
>>> this.x * 2 + 3
((this.x * 2) + 3)
>>> (this.x * 2 + 3)({"x":7})
17
{% endhighlight %}

So we can replace all ``lambda ctx: ctx["foo"]`` by ``this.foo``: much more concise and readable.
But the actual benefit stems from a much deeper reason: since we're no longer dealing with 
**black-box** lambda functions, we can drill down into them and generate the appropriate C code. 

Construct 2
-----------

I had to do some Construct work recently, and I missed the conciseness of ``this`` expressions,
and I decided I'd back-port them to Construct 2. I sent a pull request to Corbin, but he's a bit
too busy to maintain the library on a regular basis, so we've created an organization and
[moved the repository to there](https://github.com/construct/construct); this is where Construct 
will be developed from now on.

Tinkering with the old code again got me sentimental, and I started to do some long-awaited 
maintenance. I decided to release version 2.1 in the summer (codenamed August), and here's the 
list of changes I'm planning to do:

* Adding ``this`` expressions
* Dropping ``construct.text`` -- it's always been an experimental feature and it's horribly 
  inefficient. If you want to parse **grammars**, you should use the appropriate tools.
* Adding Python 3 support (based on the work of [Eli Bendersky](https://github.com/MostAwesomeDude/construct/pull/19))
* 

 


Construct 3
-----------
The


















